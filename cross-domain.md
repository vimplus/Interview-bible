
# 跨域解决方案

跨域问题对于前端来说，是一个老生常谈的问题了，无论是平时工作中，以及面试中基本都会问到。本文将梳理常见的几种跨域的优缺点，以及建议的跨域解决方案。

## 什么是同源策略？
所谓同源是指`协议+域名+端口`三者相同。
同源策略限制以下几种行为：

```
1.) Cookie、LocalStorage 和 IndexDB 无法读取
2.) DOM 和 Js对象无法获得
3.) AJAX 请求不能发送
```

## 跨域方案对比

我们在工作中，用的比较多的三种解决方案：

| 方案      | 优点                                                         | 缺点                                                         | 适用场合                                                     |
| --------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| JSONP     | 1、使用简单； 2、不需要任何配置；                            | 1、GET请求； 2、数据不安全，任何人都可以调用接口； 3、存在[XSS攻击](http://blog.knownsec.com/2015/03/jsonp_security_technic/)； | 1、安全系数要求低； 2、临时使用的接口； 3、应急接口解决方案； |
| CORS      | 1、相对安全，但是如果后台配置 `Access-Control-Allow-Origin` = `*` 就不那么安全了； 2、后台或者Nginx需要配置，如果需要携带Cookie，则前端Ajax也需要配置参数； | 1、需要配置跨域的相关参数，比较麻烦； 2、如果跨域的 `Origin` 配置为 `*` , 不安全 | 1、运行环境可以自主灵活配置； 2、跨域只能代码层面处理理；    |
| PROXY代理 | 1、非常安全，同域请求； 2、前后端代码不需要任何配置          | 1、对运行环境要求较高，需要配置代理； 2、开发时也需要配置代理才能连调接口 | 1、运行环境可以自主灵活配置； 2、安全系数要求比较高；        |

### JSONP

最主要的缺点就是 `不安全`，所以公司里面建议不要使用！

### CORS

CORS，在公司里面用的比较多，对于CORS的服务端配置，一般有以下两种方式：

1. 在后台代码里统一拦截处理reponseHeader，设置CORS协议头(`推荐`)；
2. 在Nginx配置中，统一拦截返回response，设置CORS协议头(`不推荐`)；

实际项目中，使用CORS典型的场景：**H5代码部署在CDN，而后台部署在某后台服务器上。**

这种场景下，典型的CDN的环境很难自由配置，而又必须依赖后台接口数据，这时候最好的 办法就是后台代码开发时，就支持跨域。

### PROXY代理

`PROXY代理` 的方法就是通过代理层做一次中间的转发，使得对于浏览器来说，就不存在跨域的问题。

实际项目中，使用PROXY代理典型的场景：**给客户或者用户使用的后台系统**，原因主要在于：

- 对外的一些后台系统，对于安全性和稳定性要求较高；
- 同时，管理后台对于Cookie等状态依赖比较强；
- 后台的一些特殊组件，比如上传组件，有时候对于跨域是比较敏感，所以最好是不跨域，一劳永逸；

## 总结

- JSONP，能不用就不用，完全不推荐；
- CORS，最适合用于部署在CDN上面的项目，比如：H5项目；
- PROXY代理，最合适管理后台，比如：对外的给客户或者用的管理系统；